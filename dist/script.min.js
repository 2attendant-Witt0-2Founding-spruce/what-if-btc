document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementById("loading-overlay"),t=document.getElementById("app-container"),n=document.getElementById("main-headline"),a=document.getElementById("subtitle"),o=document.getElementById("year-slider"),d=document.getElementById("month-slider"),c=document.getElementById("day-slider"),l=document.getElementById("year-min-label"),r=document.getElementById("year-max-label"),i=document.getElementById("day-max-label"),s=(document.getElementById("selected-date"),document.getElementById("initial-investment")),m=document.getElementById("current-value"),u=document.getElementById("days-passed"),y=document.getElementById("growth"),g=document.getElementById("investment-display"),v=document.getElementById("investment-amount-text"),p=document.getElementById("investment-edit"),E=document.getElementById("investment-input"),h=document.getElementById("decrease-investment"),x=document.getElementById("increase-investment"),f=document.getElementById("connector-path"),I=document.getElementById("connector-svg"),B=document.getElementById("donate-btn"),$=document.getElementById("donation-section"),C=document.getElementById("copy-feedback"),L=document.getElementById("year-value-display"),b=document.getElementById("month-name-display"),w=document.getElementById("day-value-display"),F=document.getElementById("year-track-bg"),S=document.getElementById("month-track-bg"),k=document.getElementById("day-track-bg"),D=document.getElementById("donation-headline");let M=100;const A=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];let N,T,R,U,q=new Map;const Y={default:"Let's calculate the millions you never made.",neutral:"Let's see what you missed out on.",intriguing:"The most expensive question you never asked."},j={default:"WhatIfBtc",diamond:"Running the numbers on your diamond hands."},H={default:"Appreciate clean data and an open-source tool?",fire:"How a small allocation to BTC could have accelerated your FIRE journey.",coffee:"Every coffee helps add features like DCA & staking calculators."};[o,d,c].forEach((e=>{e.addEventListener("input",(()=>{O(),J()}))})),g.addEventListener("click",(()=>{g.classList.add("hidden"),p.classList.remove("hidden"),E.focus(),E.select()})),[h,x].forEach((e=>{e.addEventListener("mousedown",(e=>e.preventDefault()))}));const P=e=>{(isNaN(e)||e<=0)&&(e=1),M=e,E.value=e,J()},z=e=>{let t=parseFloat(E.value),n=1;t>=1e3?n=100:t>=100&&(n=10);let a="increase"===e?t+n:t-n;P(Math.max(1,a))};function J(){!function(){const e=parseInt(o.value),t=parseInt(d.value),n=parseInt(c.value);_(o,F),_(d,S,!0),_(c,k),L.textContent=e,b.textContent=A[t-1],w.textContent=n;const a=`${e}-${String(t).padStart(2,"0")}-${String(n).padStart(2,"0")}`,l=q.get(a)||0;let r=0,i=0;if(l>0){r=M/l*R,i=M>0?(r-M)/M*100:0}else i=-100;const g=new Date(a+"T00:00:00"),p=Math.max(0,Math.floor((U.getTime()-g.getTime())/864e5)),E="en-US",h=(l>0&&String(n).padStart(2,"0"),(e,t)=>e.toLocaleString(E,{style:"currency",currency:"USD",maximumFractionDigits:t})),x=M<100?2:0;v.textContent=h(M,x),s.textContent=h(M,x);const f=l>0?(I=r,null===I||isNaN(I)?"N/A":I<1e3?I.toLocaleString("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2}):I<1e6?"$"+(I/1e3).toFixed(2)+"K":I<1e9?"$"+(I/1e6).toFixed(2)+"M":I<1e12?"$"+(I/1e9).toFixed(2)+"B":"$"+(I/1e12).toFixed(2)+"T"):"N/A";var I;m.textContent=f;f.length>9?m.style.fontSize="1.75rem":m.style.fontSize="2rem";u.textContent=p.toLocaleString(E),y.textContent=l>0?`${i>0?"+":""}${i.toLocaleString(E,{maximumFractionDigits:2})}%`:"N/A"}(),G()}function O(){const e=parseInt(o.value),t=parseInt(d.value),n=N.getFullYear(),a=N.getMonth()+1,l=T.getFullYear(),r=T.getMonth()+1;let s=t;e===n&&t<a&&(s=a),e===l&&t>r&&(s=r),s!==t&&(d.value=s);const m=parseInt(d.value),u=new Date(e,m,0).getDate(),y=N.getDate(),g=T.getDate();c.min=e===n&&m===a?y:1,c.max=e===l&&m===r?g:u,parseInt(c.value)<parseInt(c.min)&&(c.value=c.min),parseInt(c.value)>parseInt(c.max)&&(c.value=c.max),i.textContent=c.max}function _(e,t,n=!1){const a=parseFloat(e.min),d=parseFloat(e.max),c=parseFloat(e.value),l=d-a>0?100*(c-a)/(d-a):100,r="#333842",i="#22252a";if(n){const e=parseInt(o.value),n=N.getFullYear(),a=N.getMonth()+1,d=T.getFullYear(),c=T.getMonth()+1,l=100*((e===n?a:1)-1)/11,s=100*((e===d?c:12)-12)/11;t.style.background=`linear-gradient(to right, ${i} ${l}%, ${r} ${l}%, ${r} calc(100% + ${s}%), ${i} calc(100% + ${s}%))`}else t.style.background=r;e.style.background=`linear-gradient(to right, var(--accent-color) ${l}%, transparent ${l}%)`}function Q(e){const t=e.getBoundingClientRect(),n=I.getBoundingClientRect(),a=e.max-e.min>0?(e.value-e.min)/(e.max-e.min):1;return{x:t.left-n.left+(a*(t.width-24)+12),y:t.top-n.top+t.height/2}}function G(){if(!t.classList.contains("invisible")){const e=Q(o),t=Q(d),n=Q(c),a=`M ${e.x} ${e.y} C ${e.x} ${e.y+(t.y-e.y)/2}, ${t.x} ${e.y+(t.y-e.y)/2}, ${t.x} ${t.y} C ${t.x} ${t.y+(n.y-t.y)/2}, ${n.x} ${t.y+(n.y-t.y)/2}, ${n.x} ${n.y}`;f.setAttribute("d",a)}}x.addEventListener("click",(()=>z("increase"))),h.addEventListener("click",(()=>z("decrease"))),E.addEventListener("change",(()=>P(parseFloat(E.value)))),E.addEventListener("blur",(()=>{g.classList.remove("hidden"),p.classList.add("hidden")})),B.addEventListener("click",(()=>$.classList.toggle("open"))),document.querySelectorAll(".donation-card").forEach((e=>{const t=e.querySelector(".copy-btn"),n=e.dataset.address;t&&n&&t.addEventListener("click",(()=>{const e=document.createElement("textarea");document.body.appendChild(e),e.value=n,e.select(),document.execCommand("copy"),document.body.removeChild(e),C.textContent="Address copied!",C.style.opacity="1",setTimeout((()=>{C.style.opacity="0"}),2e3)}))})),async function(){if(!await async function(){try{const e=await fetch("src/data/history.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();q=new Map(t.map((e=>[e.date,e.price])));const n=t[0],a=t[t.length-1];return N=new Date(n.date+"T00:00:00"),T=new Date(a.date+"T00:00:00"),U=T,R=a.price,!0}catch(t){return console.error("Could not load price data:",t),e.innerHTML='<p class="text-xl text-red-500">Failed to load data. Ensure server is running or path is correct.</p>',!1}}())return;const i=N.getFullYear(),s=T.getFullYear();o.min=i,o.max=s,o.value=s,l.textContent=i,r.textContent=s,d.value=T.getMonth()+1,c.value=T.getDate(),function(){const e=new URLSearchParams(window.location.search),t=parseFloat(e.get("amount"));!isNaN(t)&&t>0&&(M=t);const l=e.get("date");if(l&&/^\d{4}-\d{2}-\d{2}$/.test(l)){const[e,t,n]=l.split("-").map(Number),a=new Date(e,t-1,n);a>=N&&a<=T&&(o.value=e,d.value=t,c.value=n)}const r=e.get("utm_campaign");if(r)switch(r){case"neutral":a.textContent=Y.neutral;break;case"intriguing":a.textContent=Y.intriguing;break;case"diamond_hands":n.textContent=j.diamond;break;case"fire_journey":D.textContent=H.fire;break;case"coffee":D.textContent=H.coffee}}(),O(),J(),e.style.display="none",t.classList.remove("invisible"),document.querySelectorAll(".donation-card").forEach((e=>{const t=e.dataset.address,n=e.querySelector(".qr-code-container");t&&n&&new QRCode(n,{text:t,width:112,height:112,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})})),requestAnimationFrame(G),window.addEventListener("resize",G)}()}));