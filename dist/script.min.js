document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementById("loading-overlay"),t=document.getElementById("app-container"),n=document.getElementById("main-headline"),a=document.getElementById("subtitle"),o=document.getElementById("year-slider"),c=document.getElementById("month-slider"),d=document.getElementById("day-slider"),i=document.getElementById("year-min-label"),l=document.getElementById("year-max-label"),r=document.getElementById("day-max-label"),s=(document.getElementById("selected-date"),document.getElementById("initial-investment")),u=document.getElementById("current-value"),m=document.getElementById("days-passed"),y=document.getElementById("growth"),g=document.getElementById("connector-path"),v=document.getElementById("connector-svg"),x=document.getElementById("donate-btn"),h=document.getElementById("donation-section"),p=document.getElementById("copy-feedback"),f=document.getElementById("year-value-display"),E=document.getElementById("month-name-display"),C=document.getElementById("day-value-display"),B=document.getElementById("year-track-bg"),I=document.getElementById("month-track-bg"),$=document.getElementById("day-track-bg"),w=document.getElementById("donation-headline");let b=100;const L=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];let k,S,F,D,A=new Map;const M={default:"Let's calculate the millions you never made.",neutral:"Let's see what you missed out on.",intriguing:"The most expensive question you never asked."},N={default:"WhatIfBtc",diamond:"Running the numbers on your diamond hands."},T={default:"Appreciate clean data and an open-source tool?",fire:"How a small allocation to BTC could have accelerated your FIRE journey.",coffee:"Every coffee helps add features like DCA & staking calculators."};function U(){const e=parseInt(o.value),t=parseInt(c.value),n=parseInt(d.value);R(o,B),R(c,I,!0),R(d,$),f.textContent=e,E.textContent=L[t-1],C.textContent=n;const a=`${e}-${String(t).padStart(2,"0")}-${String(n).padStart(2,"0")}`,i=A.get(a)||0;let l=0,r=0;if(i>0){l=b/i*F,r=100*(l-b)/b}else r=-100;const g=new Date(a+"T00:00:00"),v=Math.max(0,Math.floor((D-g)/864e5)),x=b<100?2:0;var h;s.textContent=(h=x,b.toLocaleString("en-US",{style:"currency",currency:"USD",maximumFractionDigits:h}));const p=i>0?null===(w=l)||isNaN(w)?"N/A":w<1e3?w.toLocaleString("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2}):w<1e6?"$"+(w/1e3).toFixed(2)+"K":w<1e9?"$"+(w/1e6).toFixed(2)+"M":w<1e12?"$"+(w/1e9).toFixed(2)+"B":"$"+(w/1e12).toFixed(2)+"T":"N/A";var w;u.textContent=p,u.style.fontSize=p.length>9?"1.75rem":"2rem",m.textContent=v.toLocaleString("en-US"),y.textContent=i>0?`${r>0?"+":""}${r.toLocaleString("en-US",{maximumFractionDigits:2})}%`:"N/A"}function R(e,t,n=!1){const a=+e.min,c=+e.max,d=+e.value,i=c-a>0?100*(d-a)/(c-a):100,l="#333842",r="#22252a";if(n){const e=+o.value,n=k.getFullYear(),a=k.getMonth()+1,c=S.getFullYear(),d=S.getMonth()+1,i=100*((e===n?a:1)-1)/11,s=100*((e===c?d:12)-12)/11;t.style.background=`linear-gradient(to right, ${r} ${i}%, ${l} ${i}%, ${l} calc(100% + ${s}%), ${r} calc(100% + ${s}%))`}else t.style.background=l;e.style.background=`linear-gradient(to right, var(--accent-color) ${i}%, transparent ${i}%)`}function q(e){const t=e.getBoundingClientRect(),n=v.getBoundingClientRect(),a=e.max-e.min>0?(e.value-e.min)/(e.max-e.min):1;return{x:t.left-n.left+(a*(t.width-24)+12),y:t.top-n.top+t.height/2}}function Y(){if(t.classList.contains("invisible"))return;const e=q(o),n=q(c),a=q(d),i=`M ${e.x} ${e.y} C ${e.x} ${e.y+(n.y-e.y)/2}, ${n.x} ${e.y+(n.y-e.y)/2}, ${n.x} ${n.y} C ${n.x} ${n.y+(a.y-n.y)/2}, ${a.x} ${n.y+(a.y-n.y)/2}, ${a.x} ${a.y}`;g.setAttribute("d",i)}function _(){const e=new URLSearchParams(window.location.search),t=parseFloat(e.get("amount"));!isNaN(t)&&t>0&&(b=t);const i=e.get("date");if(i&&/^\d{4}-\d{2}-\d{2}$/.test(i)){const[e,t,n]=i.split("-").map(Number),a=new Date(e,t-1,n);a>=k&&a<=S&&(o.value=e,c.value=t,d.value=n)}const l=e.get("utm_campaign");if(l)switch(l){case"neutral":a.textContent=M.neutral;break;case"intriguing":a.textContent=M.intriguing;break;case"diamond_hands":n.textContent=N.diamond;break;case"fire_journey":w.textContent=T.fire;break;case"coffee":w.textContent=T.coffee}}function j(){U(),Y()}function P(){const e=+o.value,t=+c.value,n=k.getFullYear(),a=k.getMonth()+1,i=S.getFullYear(),l=S.getMonth()+1;let s=t;e===n&&t<a&&(s=a),e===i&&t>l&&(s=l),s!==t&&(c.value=s);const u=+c.value,m=new Date(e,u,0).getDate(),y=k.getDate(),g=S.getDate();d.min=e===n&&u===a?y:1,d.max=e===i&&u===l?g:m,+d.value<+d.min&&(d.value=d.min),+d.value>+d.max&&(d.value=d.max),r.textContent=d.max}function H(){window.innerWidth<768&&document.body.classList.contains("overflow-hidden")&&document.body.classList.remove("overflow-hidden")}function _(){const e=new URLSearchParams(window.location.search),t=parseFloat(e.get("amount"));if(!isNaN(t)&&t>0){b=t;const e=document.getElementById("investment-input");e&&(e.value=t)}const i=e.get("date");if(i&&/^(\d{4})-(\d{2})-(\d{2})$/.test(i)){const[e,t,n]=i.split("-").map(Number),a=new Date(e,t-1,n);a>=k&&a<=S&&(o.value=e,c.value=t,d.value=n)}const l=e.get("utm_campaign");if(l)switch(l){case"neutral":a.textContent=M.neutral;break;case"intriguing":a.textContent=M.intriguing;break;case"diamond_hands":n.textContent=N.diamond;break;case"fire_journey":w.textContent=T.fire;break;case"coffee":w.textContent=T.coffee}}[o,c,d].forEach((e=>e.addEventListener("input",(()=>{P(),j()})))),x?.addEventListener("click",(()=>h.classList.toggle("open"))),document.querySelectorAll(".donation-card").forEach((e=>{const t=e.querySelector(".copy-btn"),n=e.dataset.address;t&&n&&t.addEventListener("click",(()=>{const e=document.createElement("textarea");document.body.appendChild(e),e.value=n,e.select(),document.execCommand("copy"),document.body.removeChild(e),p.textContent="Address copied!",p.style.opacity="1",setTimeout((()=>{p.style.opacity="0"}),2e3)}))})),async function(){await async function(){try{const e=await fetch("src/data/history.json");if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();return A=new Map(t.map((e=>[e.date,e.price]))),k=new Date(t[0].date+"T00:00:00"),S=new Date(t[t.length-1].date+"T00:00:00"),D=S,F=t[t.length-1].price,!0}catch(t){return console.error(t),e.innerHTML='<p class="text-xl text-red-500">Failed to load data.</p>',!1}}()&&(o.min=k.getFullYear(),o.max=S.getFullYear(),o.value=S.getFullYear(),i.textContent=o.min,l.textContent=o.max,c.value=S.getMonth()+1,d.value=S.getDate(),_(),P(),j(),e.style.display="none",t.classList.remove("invisible"),document.querySelectorAll(".donation-card").forEach((e=>{const t=e.dataset.address,n=e.querySelector(".qr-code-container");t&&n&&new QRCode(n,{text:t,width:112,height:112,colorDark:"#000",colorLight:"#fff",correctLevel:QRCode.CorrectLevel.H})})),requestAnimationFrame(Y),window.addEventListener("resize",Y))}(),H(),window.addEventListener("resize",H),[o,c,d].forEach((e=>e.addEventListener("input",(()=>{P(),j()})))),x?.addEventListener("click",(()=>h.classList.toggle("open")));const z=document.getElementById("investment-input"),J=document.getElementById("decrease-investment"),O=document.getElementById("increase-investment");z&&z.addEventListener("input",(()=>{const e=parseFloat(z.value);!isNaN(e)&&e>0&&(b=e,j())})),J&&J.addEventListener("click",(()=>{b=Math.max(.01,b-1),z.value=b.toFixed(2),j()})),O&&O.addEventListener("click",(()=>{b+=1,z.value=b.toFixed(2),j()})),document.querySelectorAll(".donation-card").forEach((e=>{const t=e.querySelector(".copy-btn"),n=e.dataset.address;t&&n&&t.addEventListener("click",(()=>{const e=document.createElement("textarea");document.body.appendChild(e),e.value=n,e.select(),document.execCommand("copy"),document.body.removeChild(e),p.textContent="Address copied!",p.style.opacity="1",setTimeout((()=>{p.style.opacity="0"}),2e3)}))}))}));