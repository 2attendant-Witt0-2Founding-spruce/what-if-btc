document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementById("loading-overlay"),t=document.getElementById("app-container"),n=document.getElementById("main-headline"),o=document.getElementById("subtitle"),a=document.getElementById("year-slider"),d=document.getElementById("month-slider"),c=document.getElementById("day-slider"),i=document.getElementById("year-min-label"),l=document.getElementById("year-max-label"),r=(document.getElementById("day-max-label"),document.getElementById("initial-investment")),s=document.getElementById("current-value"),m=document.getElementById("days-passed"),u=document.getElementById("growth"),y=document.getElementById("connector-path"),g=document.getElementById("connector-svg"),v=document.getElementById("donation-section"),x=document.getElementById("copy-feedback"),f=document.getElementById("year-value-display"),h=document.getElementById("month-name-display"),E=document.getElementById("day-value-display"),p=document.getElementById("year-track-bg"),B=document.getElementById("month-track-bg"),$=document.getElementById("day-track-bg"),w=document.getElementById("donation-headline"),I=document.getElementById("investment-input"),C=document.getElementById("decrease-investment"),b=document.getElementById("increase-investment"),L=document.getElementById("donate-btn");let S=100;const k=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];let F,A,M,N,T=new Map;const D={default:"Let's calculate the millions you never made.",neutral:"Let's see what you missed out on.",intriguing:"The most expensive question you never asked."},R={default:"WhatIfBtc",diamond:"Running the numbers on your diamond hands."},U={default:"Appreciate clean data and an open-source tool?",fire:"How a small allocation to BTC could have accelerated your FIRE journey.",coffee:"Every coffee helps add features like DCA & staking calculators."};function q(){const e=+a.value,t=+d.value,n=+c.value;H(a,p),H(d,B,!0),H(c,$),f.textContent=e,h.textContent=k[t-1],E.textContent=n;const o=`${e}-${String(t).padStart(2,"0")}-${String(n).padStart(2,"0")}`,i=T.get(o)||0;let l=0,y=0;if(i>0){l=S/i*M,y=100*(l-S)/S}else y=-100;const g=new Date(o+"T00:00:00"),v=Math.max(0,Math.floor((N-g)/864e5)),x=S<100?2:0;var w;r.textContent=(w=x,S.toLocaleString("en-US",{style:"currency",currency:"USD",maximumFractionDigits:w}));const I=i>0?null==(C=l)||isNaN(C)?"N/A":C<1e3?C.toLocaleString("en-US",{style:"currency",currency:"USD",maximumFractionDigits:2}):C<1e6?"$"+(C/1e3).toFixed(2)+"K":C<1e9?"$"+(C/1e6).toFixed(2)+"M":C<1e12?"$"+(C/1e9).toFixed(2)+"B":"$"+(C/1e12).toFixed(2)+"T":"N/A";var C;s.textContent=I,s.style.fontSize=I.length>9?"1.75rem":"2rem",m.textContent=v.toLocaleString("en-US"),u.textContent=i>0?`${y>0?"+":""}${y.toLocaleString("en-US",{maximumFractionDigits:2})}%`:"N/A"}function H(e,t,n=!1){const o=+e.min,d=+e.max,c=+e.value,i=d>o?100*(c-o)/(d-o):100,l="#333842",r="#22252a";if(n){const e=+a.value,n=F.getFullYear(),o=F.getMonth()+1,d=A.getFullYear(),c=A.getMonth()+1,i=100*((e===n?o:1)-1)/11,s=100*((e===d?c:12)-12)/11;t.style.background=`linear-gradient(to right, ${r} ${i}%, ${l} ${i}%, ${l} calc(100% + ${s}%), ${r} calc(100% + ${s}%))`}else t.style.background=l;e.style.background=`linear-gradient(to right, var(--accent-color) ${i}%, transparent ${i}%)`}function Y(e){const t=e.getBoundingClientRect(),n=g.getBoundingClientRect(),o=e.max-e.min>0?(e.value-e.min)/(e.max-e.min):1;return{x:t.left-n.left+(o*(t.width-24)+12),y:t.top-n.top+t.height/2}}function j(){if(t.classList.contains("invisible"))return;const e=Y(a),n=Y(d),o=Y(c),i=`M ${e.x} ${e.y} C ${e.x} ${e.y+(n.y-e.y)/2}, ${n.x} ${e.y+(n.y-e.y)/2}, ${n.x} ${n.y} C ${n.x} ${n.y+(o.y-n.y)/2}, ${o.x} ${n.y+(o.y-n.y)/2}, ${o.x} ${o.y}`;y.setAttribute("d",i)}function P(){const e=window.innerWidth<768;document.querySelectorAll(".donation-card").forEach((t=>{const n=t.dataset.address,o=t.querySelector(".qr-code-container"),a=t.querySelector(".copy-btn"),d=t.querySelector(".network-name");if(d&&d.remove(),e){o&&(o.style.display="none");const e=t.dataset.network||"Bitcoin";if(a){const n=document.createElement("div");n.className="network-name mb-2 text-sm font-medium text-gray-700",n.textContent=e,t.insertBefore(n,a)}}else o&&(o.style.display="",o.innerHTML="",n&&new QRCode(o,{text:n,width:112,height:112,colorDark:"#000",colorLight:"#fff",correctLevel:QRCode.CorrectLevel.H}))}))}function _(){q(),j()}function J(){window.innerWidth<768&&document.body.classList.contains("overflow-hidden")&&document.body.classList.remove("overflow-hidden")}[a,d,c].forEach((e=>e.addEventListener("input",_))),I&&I.addEventListener("input",(()=>{const e=parseFloat(I.value);!isNaN(e)&&e>0&&(S=e,_())})),C&&C.addEventListener("click",(()=>{S=Math.max(.01,S-1),I.value=S.toFixed(2),_()})),b&&b.addEventListener("click",(()=>{S+=1,I.value=S.toFixed(2),_()})),L&&L.addEventListener("click",(()=>v?.classList.toggle("open"))),document.querySelectorAll(".donation-card").forEach((e=>{const t=e.querySelector(".copy-btn"),n=e.dataset.address;t&&n&&t.addEventListener("click",(()=>{const e=document.createElement("textarea");document.body.appendChild(e),e.value=n,e.select(),document.execCommand("copy"),document.body.removeChild(e),x.textContent="Address copied!",x.style.opacity="1",setTimeout((()=>{x.style.opacity="0"}),2e3)}))})),J(),async function(){await async function(){try{const e=await fetch("src/data/history.json");if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();return T=new Map(t.map((e=>[e.date,e.price]))),F=new Date(t[0].date+"T00:00:00"),A=new Date(t[t.length-1].date+"T00:00:00"),N=A,M=t[t.length-1].price,!0}catch(t){return console.error(t),e.innerHTML='<p class="text-xl text-red-500">Failed to load data.</p>',!1}}()&&(a.min=F.getFullYear(),a.max=A.getFullYear(),a.value=A.getFullYear(),i.textContent=a.min,l.textContent=a.max,d.value=A.getMonth()+1,c.value=A.getDate(),function(){const e=new URLSearchParams(window.location.search),t=parseFloat(e.get("amount"));!isNaN(t)&&t>0&&(S=t,I&&(I.value=t.toFixed(2)));const i=e.get("date");if(i&&/^\d{4}-\d{2}-\d{2}$/.test(i)){const[e,t,n]=i.split("-").map(Number),o=new Date(e,t-1,n);o>=F&&o<=A&&(a.value=e,d.value=t,c.value=n)}const l=e.get("utm_campaign");if(l)switch(l){case"neutral":o.textContent=D.neutral;break;case"intriguing":o.textContent=D.intriguing;break;case"diamond_hands":n.textContent=R.diamond;break;case"fire_journey":w.textContent=U.fire;break;case"coffee":w.textContent=TEXT_VARIANTES.donationHeadline.coffee}}(),_(),e.style.display="none",t.classList.remove("invisible"),P(),j(),window.addEventListener("resize",(()=>{j(),P(),J()})))}()}));